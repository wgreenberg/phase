<html>
<head>
<script>

async function loadBuffer(ctx, path) {
    const response = await fetch(path);
    const arrayBuffer = await response.arrayBuffer();
    const audioBuffer = await ctx.decodeAudioData(arrayBuffer);
    return audioBuffer;
}

function createBufferSource(ctx, buffer) {
    let source = ctx.createBufferSource();
    source.buffer = buffer;
    source.connect(ctx.destination);
    return source;
}

async function loadNotes(ctx, volume, notes) {
    return await Promise.all(notes.map(async (note) => {
        const buffer = await loadBuffer(ctx, `samples/${volume}/${note}.mp3`);
        return createBufferSource(ctx, buffer);
    }));
}

function cloneNotes(ctx, notes) {
    return notes.map(note => createBufferSource(ctx, note.buffer));
}

window.addEventListener('load', async () => {
    setTimeout(() => location.reload(), 3000);
    const ctx = new AudioContext();
    const notes = await loadNotes(ctx, 'mf', ['C3', 'E3', 'G3', 'B3', 'D4']);
    notes.map(note => note.start());
    const notes2 = cloneNotes(ctx, notes);
    notes2.map(note => note.start(0.5));
});
</script>
</head>
<body>
</body>
</html>
